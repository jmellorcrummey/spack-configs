spack:
  view: false
  concretizer:
    unify: when_possible
  packages:
    all:
      compiler: [gcc@=11.4.0, gcc@=12.3.0]
      variants: [cuda_arch=80]
    cuda:
      variants: [+allow-unsupported-compilers]
    openmpi:
      version: [4.1.5]
    mpich:
      version: [4.1.2]
  specs:
  - matrix:
    - ['openmpi +cuda fabrics=ucx', 'mpich +cuda pmi=pmix netmod=ucx']
    - ['^cuda@11.8']
    - ['%gcc@11.4.0', '%gcc@12.3.0']
  modules:
    default:
      enable: [tcl]
      roots:
        tcl: /projects/modulefiles
      arch_folder: false
      tcl:
        include: [openmpi, mpich]
        exclude: ['@:']
        hash_length: 0
        projections:
          +cuda: '{name}/{version}/{compiler.name}-{compiler.version}/cuda-{^cuda.version}'
