spack:
  view: false
  concretizer:
    unify: when_possible
  packages:
    all:
      compiler: [gcc]
    python:
      buildable: false
#    cuda:
#      variants: [+allow-unsupported-compilers]
    openmpi:
      version: [4.1.5]
    mpich:
      version: [4.1.2]
  specs:
  - matrix:
    - [openmpi fabrics=ucx]
    - ['%gcc@8.5.0', '%gcc@11.4.0', '%gcc@12.3.0', '%gcc@13.2.0']
    - [~cuda]
  - matrix:
    - [mpich pmi=pmix netmod=ucx datatype-engine=yaksa]
    - ['%gcc@8.5.0', '%gcc@11.4.0', '%gcc@12.3.0', '%gcc@13.2.0']
    - [~cuda ~rocm]
  modules:
    prefix_inspections:
      ./lib: [LD_LIBRARY_PATH]
      ./lib64: [LD_LIBRARY_PATH]
    default:
      enable: [tcl]
      roots:
        tcl: /projects/deploy/moduleroot/
      arch_folder: false
      tcl:
        include: [openmpi, mpich]
        exclude: ['@:']
        hash_length: 0
        projections:
          all: '{compiler.name}-{compiler.version}/{name}/{version}/cpu'
          ^cuda: '{compiler.name}-{compiler.version}/{name}/{version}/cuda-{^cuda.version}'
          ^hip: '{compiler.name}-{compiler.version}/{name}/{version}/rocm-{^hip.version}'
        ^cuda:
          load: ['cuda/{^cuda.version}']
        ^hip:
          load: ['rocm/{^hip.version}']
